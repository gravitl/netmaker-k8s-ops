# Default values for netmaker-k8s-ops.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: netmaker-k8s-ops
  pullPolicy: Always
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Namespace where the operator will be deployed
namespace:
  create: false  # Set to true if you want the chart template to create the namespace
                 # Recommended: Use --create-namespace flag instead (Helm best practice)
  # If not set, will use release-name-system format
  name: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext:
  allowPrivilegeEscalation: true
  capabilities:
    drop:
    - "ALL"

# Manager container configuration
manager:
  args:
    - --leader-elect
    - --health-probe-bind-address=:8081
    - --metrics-bind-address=0
    # Verbosity: Use --zap-log-level=debug for debug logs, or -v=<0-10> for numeric verbosity
    # - --zap-log-level=info  # Options: debug, info, error (default: info)
    # - -v=1  # Numeric verbosity (0-10, higher = more verbose)
  # Configuration via ConfigMap
  configMap:
    inCluster: "true"
    enableLeaderElection: "true"
    proxySkipTLSVerify: "true"
    proxyMode: "auth"
    verbosity: "info"  # Set via: --set manager.configMap.verbosity="debug". Options: debug, info, error

# API configuration for user IP mapping sync
api:
  enabled: true  # Enable API integration
  serverDomain: ""  # Set via: --set api.serverDomain="api.example.com"
  token: ""  # Set via: --set api.token="your-token"
  syncInterval: "300"  # Set via: --set api.syncInterval="300"
  resources:
    limits:
      cpu: 500m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 64Mi

# Netclient sidecar configuration
netclient:
  enabled: true
  image:
    repository: gravitl/netclient
    tag: v1.4.0
    pullPolicy: Always
  token: ""  # Netmaker token - will be stored in a Kubernetes Secret. Set via: --set netclient.token="your-token"
  env:
    - name: DAEMON
      value: "on"
    - name: LOG_LEVEL
      value: "info"
  resources:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

# Webhook configuration
# In config/, webhook is disabled by default (commented out in kustomization.yaml)
webhook:
  enabled: false
  # Certificate configuration
  cert:
    # If using cert-manager, set this to the certificate name
    # cert-manager.io/inject-ca-from: namespace/certificate-name
    injectCAFrom: ""

# Services configuration
service:
  # Webhook service
  webhook:
    enabled: false
    type: ClusterIP
    port: 443
    targetPort: 9443
  # Proxy service
  proxy:
    enabled: true
    type: ClusterIP
    port: 8085
    targetPort: proxy  # Port name (matches container port name)
  # Metrics service
  metrics:
    enabled: false
    type: ClusterIP
    port: 8443
    targetPort: 8443

# RBAC configuration
rbac:
  create: true
  # Use broad permissions (all resources, all verbs)
  # Set to false to use minimal permissions
  useBroadPermissions: true

# Leader election configuration
leaderElection:
  enabled: true
  # Leader election ID
  id: "3820d23d.netmaker.io"

# Health probes configuration
probes:
  startup:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 20
  liveness:
    initialDelaySeconds: 15
    periodSeconds: 20
  readiness:
    initialDelaySeconds: 5
    periodSeconds: 10

# Volumes configuration
volumes:
  # Netclient config volume configuration
  netclientConfig:
    # Use PVC instead of hostPath (recommended for production)
    usePVC: true
    # PVC name (defaults to {fullname}-netclient-pvc)
    pvcName: ""
    # Storage size for PVC
    storageSize: 1Gi
    # Access modes for PVC (ReadWriteOnce recommended for single replica)
    accessModes: []
      # - ReadWriteOnce
    # Storage class name (leave empty to use default)
    storageClassName: ""
    # Volume name to reuse existing PV (optional)
    volumeName: ""
    # PVC annotations
    annotations: {}
    # Fallback to hostPath if usePVC is false
    hostPath: /etc/netclient
    type: DirectoryOrCreate
  # EmptyDir for netclient logs
  netclientLogs:
    enabled: true

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

# Deployment strategy configuration
deployment:
  # Strategy type: Recreate (recommended when using PVC with ReadWriteOnce) or RollingUpdate
  # If not specified, defaults to Recreate when using PVC
  strategy: {}
    # type: Recreate
    # type: RollingUpdate
    # rollingUpdate:
    #   maxSurge: 1
    #   maxUnavailable: 0

nodeSelector: {}

tolerations: []

affinity: {}

# CRD installation
# CRDs are automatically installed from the crds/ directory when using Helm.
# CRDs are NOT deleted when uninstalling the chart (this is Helm's default behavior).
# To remove CRDs manually, use: kubectl delete crd netmakerops.network.netmaker.io
